{% extends 'base.html' %}

{% block title %}Login{% endblock %}

{% block content %}
<br><br>
<div class="card p-4 bg-light mx-auto" style="max-width: 400px; border-radius: 10px;">
    <h2 class="mb-4" style="text-align: center;">Login</h2>
    <form id="loginForm">
        <div class="form-group">
            <input type="text" id="username" class="form-control form-control-sm" placeholder="Nom d'utilisateur" required>
        </div> 
        <br>
        <div class="form-group">
            <input type="password" id="password" class="form-control form-control-sm" placeholder="Mot de passe" required>
        </div>
        <br>
        <div class="form-group">
            <button type="submit" class="btn btn-primary btn-sm">Login</button>
        </div>
    </form>
    <div id="message" style="text-align: center; margin-top: 10px;"></div>
</div>

<script>
    document.getElementById('loginForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
            const response = await fetch('/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            });
            const data = await response.json();
            if (response.ok) {
                document.getElementById('message').innerText = data.message;
                window.location.href = data.redirect; // Redirection vers le dashboard
            } else {
                document.getElementById('message').innerText = data.error || data.errors.join(', ');
            }
        } catch (error) {
            document.getElementById('message').innerText = 'Erreur lors de la connexion.';
        }
    
        
    
    });
</script>
{% endblock %}
